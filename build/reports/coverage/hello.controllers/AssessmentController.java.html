<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>AssessmentController.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SHRPAS_Project</a> &gt; <a href="index.source.html" class="el_package">hello.controllers</a> &gt; <span class="el_source">AssessmentController.java</span></div><h1>AssessmentController.java</h1><pre class="source lang-java linenums">package hello.controllers;

import hello.helpers.PatchClasses;
import hello.models.Assessment;
import hello.models.Question;
import hello.models.User;
import hello.repositories.AssessmentRepository;
import hello.repositories.QuestionRepository;
import hello.repositories.UserRepository;
import hello.repositories.exceptions.AssessmentNotFoundException;
import hello.repositories.exceptions.NotAuthorizedException;
import hello.repositories.exceptions.QuestionNotFoundException;
import hello.repositories.exceptions.UserNotFoundException;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpSession;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.Set;
import java.util.TreeSet;


/**
localhost:8080/assessments
 */
@RestController
public class AssessmentController{



    private AssessmentRepository assessmentRepository;
    private QuestionRepository questionRepository;
    private UserRepository userRepository;

    @Autowired
<span class="fc" id="L39">    public AssessmentController(AssessmentRepository assessmentRepository, QuestionRepository questionRepository,UserRepository userRepository){</span>
<span class="fc" id="L40">        this.assessmentRepository = assessmentRepository;</span>
<span class="fc" id="L41">        this.questionRepository = questionRepository;</span>
<span class="fc" id="L42">        this.userRepository=userRepository;</span>
<span class="fc" id="L43">    }</span>


    /**
        localhost:8080/rest/assessments/{id}/
        Gets a Assessment
     */
    @RequestMapping(value = &quot;/rest/assessments/{id}/&quot;, method=RequestMethod.GET)
    public ResponseEntity&lt;Assessment&gt; getAssessment(@PathVariable(&quot;id&quot;) int assessmentID) {
<span class="fc" id="L52">        Assessment assessment = this.assessmentRepository.findOne(assessmentID);</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">        if(assessment != null){</span>
<span class="fc" id="L54">            return new ResponseEntity&lt;Assessment&gt;(assessment, HttpStatus.OK);</span>
        }else{
<span class="fc" id="L56">            return new ResponseEntity&lt;Assessment&gt;(assessment, HttpStatus.BAD_REQUEST);</span>
        }
    }

    /**
     * Adds an assessment
     * @param assessment The Body of the Assessment
     * @return The Assessment
     */
    @RequestMapping(value = &quot;/rest/assessments&quot;, method=RequestMethod.POST)
    public ResponseEntity&lt;Assessment&gt; addAssessment(HttpSession session,@RequestBody Assessment assessment) throws Exception
    {
        /*******************************************************************/
        /* Add the Assessment                                              */
        /*******************************************************************/
<span class="fc" id="L71">        Assessment newAssessment = assessmentRepository.save(assessment);</span>
<span class="fc" id="L72">        newAssessment.setUsersSet(((new HashSet&lt;User&gt;() {</span>
        })));

        /*******************************************************************/
        /* Adds the User to the assessment                                 */
        /*******************************************************************/
<span class="fc" id="L78">        this.addUserToAssessment(newAssessment, AuthenticationController.GetUser(session));</span>

        /*******************************************************************/
<span class="fc" id="L81">        return new ResponseEntity&lt;Assessment&gt;(newAssessment, HttpStatus.OK);</span>
    }

    /**
     * Updates an assessment
     * @param assessmentID The Id of the Assessment to be used
     * @return The Assessment
     */
    @RequestMapping(value = &quot;/rest/assessments/{id}&quot;, method=RequestMethod.PATCH)
    public ResponseEntity&lt;Assessment&gt; updateAssessment(@PathVariable(&quot;id&quot;) int assessmentID, @RequestBody Assessment assessment) throws Exception {
<span class="fc" id="L91">        Assessment assessmentToBeUpdated = assessmentRepository.findOne(assessmentID);</span>

        /*******************************************************************/
<span class="fc bfc" id="L94" title="All 2 branches covered.">        if(assessmentToBeUpdated == null)</span>
        {
<span class="fc" id="L96">            throw new AssessmentNotFoundException(assessmentID);</span>
        }

        /*******************************************************************/
<span class="fc" id="L100">        PatchClasses.PerformAPatch(assessmentToBeUpdated, assessment);</span>
<span class="fc" id="L101">        return new ResponseEntity&lt;Assessment&gt;(assessmentToBeUpdated, HttpStatus.OK);</span>
    }

    /**
     * Adds a question to an assessment
     * @param assessmentID The Id of the Assessment to be used
     * @param question The body of a question(Will be creating a new question)
     * @return The Assessment
     */
    @RequestMapping(value = &quot;/rest/assessments/{id}/question&quot;, method=RequestMethod.POST)
    public ResponseEntity&lt;Assessment&gt; addQuestion(@PathVariable(&quot;id&quot;) int assessmentID, @RequestBody Question question) throws Exception
    {
<span class="fc" id="L113">        Assessment assessment = assessmentRepository.findOne(assessmentID);</span>

        /*******************************************************************/
<span class="fc bfc" id="L116" title="All 2 branches covered.">        if(assessment != null)</span>
        {
<span class="fc" id="L118">            assessment = this.addQuestionToAssessment(assessment, question);</span>
<span class="fc" id="L119">            return new ResponseEntity&lt;Assessment&gt;(assessment, HttpStatus.OK);</span>
        }

        /*******************************************************************/
        else
        {
<span class="fc" id="L125">            throw new AssessmentNotFoundException(assessmentID);</span>
        }
    }

    /**
     * Adds an existing question to an assessment
     * @param assessmentID The Id of the Assess to be used
     * @param questionId The id of the Question to be used
     * @return The Assessment
     */
    @RequestMapping(value = &quot;/rest/assessments/{id}/question/{questionId}&quot;, method=RequestMethod.POST)
    public ResponseEntity&lt;Assessment&gt; addExistingQuestion(@PathVariable(&quot;id&quot;) int assessmentID, @PathVariable(&quot;questionId&quot;) int questionId){
<span class="fc" id="L137">        Assessment assessment = assessmentRepository.findOne(assessmentID);</span>

        /*******************************************************************/
        /* We have found the assessment                                    */
        /*******************************************************************/
<span class="fc bfc" id="L142" title="All 2 branches covered.">        if(assessment != null)</span>
        {
<span class="fc" id="L144">            Question question = questionRepository.findOne(questionId);</span>

            /***************************************************************/
<span class="fc bfc" id="L147" title="All 2 branches covered.">            if(question != null)</span>
            {
<span class="fc" id="L149">                assessment = this.addQuestionToAssessment(assessment, question);</span>
<span class="fc" id="L150">                return new ResponseEntity&lt;Assessment&gt;(assessment, HttpStatus.OK);</span>
            }
            else
            {
<span class="fc" id="L154">                throw new QuestionNotFoundException(questionId);</span>
            }
        }
        else
        {
<span class="fc" id="L159">            throw new AssessmentNotFoundException(assessmentID);</span>
        }
    }

    /**
     * Adds a question to an assessment
     * @param assessmentID Assessment ID
     * @param user User that is being added(Must exist)
     * @return ResponseEntity&lt;Assessment&gt;
     */
    @RequestMapping(value = &quot;/rest/assessments/{id}/users&quot;, method=RequestMethod.POST)
    public ResponseEntity&lt;Assessment&gt; addUser(@PathVariable(&quot;id&quot;) int assessmentID, @RequestBody User user) throws Exception {
<span class="fc" id="L171">        Assessment assessment = assessmentRepository.findOne(assessmentID);</span>
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">        if(assessment != null)</span>
        {
            /***************************************************************/
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">            if(user==null)</span>
            {
<span class="nc" id="L177">                throw new UserNotFoundException(&quot;No User Name was found in the body&quot;);</span>
            }

            /***************************************************************/
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">            if(user.getUsername()==null)</span>
            {
<span class="nc" id="L183">                throw new UserNotFoundException(null,&quot;No User Name was found in the body&quot;);</span>
            }

            /***************************************************************/
<span class="fc" id="L187">            User foundUser=userRepository.findOne(user.getUsername());</span>

            /***************************************************************/
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">            if(foundUser==null)</span>
            {
<span class="nc" id="L192">                throw new UserNotFoundException(user.getUsername());</span>
            }

            /***************************************************************/
<span class="fc" id="L196">            assessment = this.addUserToAssessment(assessment, foundUser);</span>
<span class="fc" id="L197">            return new ResponseEntity&lt;Assessment&gt;(assessment, HttpStatus.OK);</span>
        }
        else
        {
<span class="nc" id="L201">            throw new AssessmentNotFoundException(assessmentID);</span>
        }
    }

    /**
     * Adds a question to an assessment
     * @param session Users Session(Were we will pick the user making the request)
     * @return ResponseEntity&lt;Assessment&gt;
     */
    @RequestMapping(value = &quot;/rest/assessments&quot;, method=RequestMethod.GET)
    public ArrayList&lt;Assessment&gt; getAllAssessments(HttpSession session) throws Exception
    {
        /*******************************************************************/
<span class="fc" id="L214">        ArrayList&lt;Assessment&gt; assessments = new ArrayList&lt;Assessment&gt;();</span>

        /*******************************************************************/
<span class="nc bnc" id="L217" title="All 2 branches missed.">        for (Assessment assessment : assessmentRepository.findForUser(AuthenticationController.GetUser(session).getUsername()))</span>
        {
<span class="nc" id="L219">            assessments.add(assessment);</span>
<span class="nc" id="L220">        }</span>

        /*******************************************************************/
<span class="nc" id="L223">        return assessments;</span>


    }



    /**
     * Deletes an assessment
     * @param assessmentID Id of the assessment
     * @return A boolean indicating if it was trully deleted
     */
    @RequestMapping(value = &quot;/rest/assessments/{id}/delete&quot;, method = RequestMethod.DELETE)
    public ResponseEntity&lt;Boolean&gt; deleteAssessment(@PathVariable(&quot;id&quot;) int assessmentID)
    {
<span class="fc" id="L238">        Assessment assessment = assessmentRepository.findOne(assessmentID);</span>

        /*******************************************************************/
<span class="fc bfc" id="L241" title="All 2 branches covered.">        if (assessment != null)</span>
        {
<span class="fc" id="L243">            assessmentRepository.delete(assessment);</span>
<span class="fc" id="L244">            return new ResponseEntity&lt;Boolean&gt;(Boolean.TRUE, HttpStatus.OK);</span>
        }

        /*******************************************************************/
        else
        {
<span class="fc" id="L250">            throw new AssessmentNotFoundException(assessmentID);</span>
        }
    }

    /***********************************************************************/
    /* To Make Life Easier                                                 */
    /***********************************************************************/
    private Assessment addQuestionToAssessment(Assessment assessment, Question question)
    {
<span class="fc" id="L259">        Set&lt;Question&gt; questionSet = assessment.getQuestionSet();</span>
<span class="fc" id="L260">        questionSet.add(question);</span>
<span class="fc" id="L261">        assessment.setQuestionSet(questionSet);</span>
<span class="fc" id="L262">        return this.assessmentRepository.save(assessment);</span>
    }

    /***********************************************************************/
    private Assessment addUserToAssessment(Assessment assessment, User user)
    {
<span class="fc" id="L268">        Set&lt;User&gt; userSet = assessment.getUsersSet();</span>
<span class="fc" id="L269">        userSet.add(user);</span>
<span class="fc" id="L270">        assessment.setUsersSet(userSet);</span>
<span class="fc" id="L271">        return this.assessmentRepository.save(assessment);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>